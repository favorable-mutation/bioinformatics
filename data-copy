#!/usr/bin/env python2.7

# TODO
# - add optional args to allow input and output directory specification
#   - note: cwd gets the current directory of the shell when the script
#     is called, not where the script is located
# - add short arg options (e.g. "-t, --time" produce the same result)
# - add a more vigorous help argument

# import modules for interacting with the operating system
import os
import sys
import time
import datetime

# import module for creating functions with option to pass them arguments
import argparse

# initialize a parser object that can process arguments
parser = argparse.ArgumentParser(description="Data transfer from polara to Brown lab file server\nPlease run this from directory you wish to transfer files from")

# add an argument "time" for the user to specify the runtime of the data collection
parser.add_argument("time", type=int, required=True,
     help="Runtime of data collection in hours - Required")

# add an argument "-i" for specifying the input directory for the copy
parser.add_argument("-i", type=str, default=os.getcwd(),
     help="Input directory - defaults to the current directory")

args = parser.parse_args()
cwd = os.getcwd()
ext = "*.tif"
copy_endtime = time.time() + 3600 * (args.time)


while time.time() < copy_endtime:
	os.system("rsync -hurvza --progress --remove-source-files `find {cwd} -type f -name '{ext:s}' -mmin +5` adrian@10.119.49.163:/media/file_server/Polara_Data/".format(cwd=cwd, ext=ext))
	time.sleep(60)
print "\nPolara data transfer completed"

